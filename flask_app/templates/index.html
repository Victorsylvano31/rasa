<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Chatbot Rasa</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <!-- CSS custom -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-light d-flex flex-column align-items-center justify-content-center vh-100">

<!-- Main content -->
<div class="text-center mb-4">
    <h1>Bienvenue sur le chatbot Rasa</h1>
    <p>Cliquez sur l'icône en bas à droite pour ouvrir le chat.</p>
</div>

<!-- Bouton flottant pour ouvrir le chat (comme une petite fenêtre) -->
<button id="chat_toggle_button" class="chat-toggle-btn">
    <i class="fas fa-comment-dots"></i>
</button>

<!-- Chat Widget (style comme une petite fenêtre popup) -->
<div id="chat_widget" class="chat-container d-none">
    <div id="chat_widget_header" class="chat-header">
        <i class="fas fa-robot mr-2"></i> Chatbot Rasa
        <button id="chat_close_button" class="close-btn"><i class="fas fa-times"></i></button>
    </div>
    <div id="chat_widget_message" class="chat-messages"></div>
    <div class="chat-input-container">
        <input id="chat_widget_input" type="text" placeholder="Tape ton message...">
        <button id="chat_send_button" class="send-button"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
$(document).ready(function(){
    // Fonction pour envoyer le message
    function sendMessage() {
        let msg = $("#chat_widget_input").val();
        if(!msg.trim()) return;
        $("#chat_widget_input").val("");
        $("#chat_widget_message").append("<div class='message user-msg'><div class='bubble'><i class='fas fa-user mr-1'></i>" + msg + "</div></div>");
        $("#chat_widget_message").scrollTop($("#chat_widget_message")[0].scrollHeight);
        
        $.ajax({
            url: "/webhook",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({message: msg}),
            success: function(data){
                $("#chat_widget_message").append("<div class='message bot-msg'><div class='bubble'><i class='fas fa-robot mr-1'></i>" + data.response + "</div></div>");
                $("#chat_widget_message").scrollTop($("#chat_widget_message")[0].scrollHeight);
            }
        });
    }

    // Événement pour la touche Enter
    $("#chat_widget_input").keypress(function(e){
        if(e.which == 13){
            sendMessage();
        }
    });

    // Bouton d'envoi
    $("#chat_send_button").click(function(){
        sendMessage();
    });

    // Ouvrir/fermer le chat
    $("#chat_toggle_button").click(function(){
        $("#chat_widget").removeClass("d-none");
        $(this).addClass("d-none");
    });

    $("#chat_close_button").click(function(){
        $("#chat_widget").addClass("d-none");
        $("#chat_toggle_button").removeClass("d-none");
    });
});
</script>
</body>
</html>